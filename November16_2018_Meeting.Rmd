---
title: "R Notebook"
output: html_notebook
---


## Creating a plot with q robur and q lobata and resequenced q lobata reference genome. 

```{r}
library(tidyverse)
library(glue)

mu <- 1.01e-8
qrobGen <- 30
qlobGen <- 50


realQRobur<-"../data/PSMCTroubleshooting/Qrob_PSMC/output_20180802/oak.msmc.out.final.txt"
realQRoburDf<-tibble(
  directories=realQRobur,
  Type="Q. robur reference genome", 
  species="Q. robur", 
  id="Q. robur"
)
realQRoburDf$files<- realQRoburDf$directories %>% map(~ read_delim(.x,delim="\t", col_names = T)) 
realQRoburDf<-realQRoburDf %>% unnest(files) %>% 
  mutate(Time=left_time_boundary/mu*gen, EffectivePopulationSize= (1/lambda_00)/(2*mu) ) %>% 
  select(-directories)  




bootstraps<-readRDS("../data/bootstraps200IterationsEmpirical_Nov8.rds")

bootstraps<-bootstraps %>%
  mutate(id=str_extract(files, pattern = "bootstraps_[0-9]+")) %>%
  mutate(species=str_extract(files, pattern="q[lr]ob")) %>%
  mutate(Type=case_when(
    species=="qlob" ~ "Q. lobata reference genome bootstrapped (MaxIterations 100; 100 Bootstraps)",
    species=="qrob" ~ "Q. robur reference genome (MaxIterations 100; 100 Bootstraps)",
    
  )) %>% 
  mutate(Time=left_time_boundary/mu*gen, EffectivePopulationSize= (1/lambda_00)/(2*mu) )
  


resequencedMSMC<-"../data/resequenced/"
msmcFiles<-list.files(resequencedMSMC, full.names = T, pattern="final.txt")
id<-str_extract(msmcFiles, pattern="QL.*00F")

msmcFilesDf<-tibble(
  msmcFiles=msmcFiles,
  id=id
  
)

msmcFilesDf$files<-msmcFilesDf$msmcFiles %>% map(~read_delim(.x, delim="\t", col_names = T))

msmcFilesDf <-msmcFilesDf %>% unnest(files)



msmcFilesDf<-msmcFilesDf  %>% 
  mutate(Time=left_time_boundary/mu*gen, EffectivePopulationSize= (1/lambda_00)/(2*mu) ) %>% 
  mutate(Type="Q. lobata resequenced genomes (MaxIterations 200)", species="Q. lobata")



##Find 
realQLobata<-"../data/PSMCTroubleshooting/Qlob_PSMC/output_20180613/oak.msmc.out.final.txt"
realQLobataDf<-tibble(
  directories=realQLobata,
  Type="Q. lobata reference genome (MaxIterations 20)",
  id="Q. lobata reference genome", 
  species="Q. lobata"
)
realQLobataDf$files<- realQLobataDf$directories %>% map(~ read_delim(.x,delim="\t", col_names = T)) 
realQLobataDf<-realQLobataDf %>% unnest(files) %>% 
  mutate(Time=left_time_boundary/mu*gen, EffectivePopulationSize= (1/lambda_00)/(2*mu) ) %>% 
  select(-directories) 

data=bind_rows(msmcFilesDf,realQLobataDf,bootstraps, realQRoburDf)




qlob<-data %>% 
  filter(species=="qlob" | species == "Q. lobata") %>%
    mutate(Time=left_time_boundary/mu*qlobGen, EffectivePopulationSize= (1/lambda_00)/(2*mu) ) 




qrob<-data %>% 
  filter(species=="qrob" | species == "Q. robur") %>%
    mutate(Time=left_time_boundary/mu*qrobGen, EffectivePopulationSize= (1/lambda_00)/(2*mu) ) 



dataTimeConverted=bind_rows(qlob,qrob)





dataTimeConverted %>% 
  filter(Type=="Q. lobata resequenced genomes (MaxIterations 200)" | Type=="Q. robur reference genome (MaxIterations 100; 100 Bootstraps)" | Type=="Q. lobata reference genome bootstrapped (MaxIterations 100; 100 Bootstraps)") %>%
  ggplot(aes(x=Time, y=EffectivePopulationSize,group=interaction(species,id), colour=Type)) + 
  geom_step() +
  theme_bw() + 
  scale_x_continuous(trans='log10',labels = scales::comma) + 
  scale_y_continuous(trans='log10') + 
  labs(x="Years Ago", y="Effective Population Size", 
       title="",
       colour="Data Type")  +
    theme_bw() +
    theme(text = element_text(size=18)) 



ggsave("../analysis/PSMCResequencedEmpiricalBootstrapsQrobQlob_November15.pdf" , width=30, height = 10)






```
